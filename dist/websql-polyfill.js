/*! For license information please see websql-polyfill.js.LICENSE.txt */
(()=>{"use strict";var e={m:{},u:e=>e+".websql-polyfill.js"};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var t;e.g.importScripts&&(t=e.g.location+"");var r=e.g.document;if(!t&&r&&(r.currentScript&&(t=r.currentScript.src),!t)){var a=r.getElementsByTagName("script");if(a.length)for(var n=a.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=a[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),e.p=t})(),e.b=document.baseURI||self.location.href;const t="function",r="64e10b34-2bf7-4616-9668-f99de5aa046e",a="get",n="has",s="set",{isArray:o}=Array;let{SharedArrayBuffer:i,window:c}=globalThis,{notify:l,wait:u,waitAsync:f}=Atomics,b=null;f||(f=e=>({value:new Promise((t=>{let r=new Worker("data:application/javascript,onmessage%3D(%7Bdata%3Ab%7D)%3D%3E(Atomics.wait(b%2C0)%2CpostMessage(0))");r.onmessage=t,r.postMessage(e)}))}));try{new i(4)}catch(e){i=ArrayBuffer;const t=new WeakMap;if(c){const e=new Map,{prototype:{postMessage:a}}=Worker,n=t=>{const a=t.data?.[r];if(!o(a)){t.stopImmediatePropagation();const{id:r,sb:n}=a;e.get(r)(n)}};b=function(e,...s){const i=e?.[r];if(o(i)){const[e,r]=i;t.set(r,e),this.addEventListener("message",n)}return a.call(this,e,...s)},f=r=>({value:new Promise((a=>{e.set(t.get(r),a)})).then((a=>{e.delete(t.get(r)),t.delete(r);for(let e=0;e<a.length;e++)r[e]=a[e];return"ok"}))})}else{const e=(e,t)=>({[r]:{id:e,sb:t}});l=r=>{postMessage(e(t.get(r),r))},addEventListener("message",(e=>{const a=e.data?.[r];if(o(a)){const[e,r]=a;t.set(r,e)}}))}}const{Int32Array:y,Map:h,Uint16Array:p}=globalThis,{BYTES_PER_ELEMENT:d}=y,{BYTES_PER_ELEMENT:w}=p,g=new WeakSet,m=new WeakMap,v={value:{then:e=>e()}};let P=0;const j=(e,{parse:c=JSON.parse,stringify:j=JSON.stringify,transform:O,interrupt:A}=JSON)=>{if(!m.has(e)){const k=b||e.postMessage,E=(t,...a)=>k.call(e,{[r]:a},{transfer:t}),q=typeof A===t?A:A?.handler,S=A?.delay||42,T=new TextDecoder("utf-16"),M=(e,t)=>e?f(t,0):(q?((e,t,r)=>{for(;"timed-out"===u(e,0,0,t);)r()})(t,S,q):u(t,0),v);let I=!1;m.set(e,new Proxy(new h,{[n]:(e,t)=>"string"==typeof t&&!t.startsWith("_"),[a]:(t,r)=>"then"===r?null:(...t)=>{const a=P++;let n=new y(new i(2*d)),s=[];g.has(t.at(-1)||s)&&g.delete(s=t.pop()),E(s,a,n,r,O?t.map(O):t);const o=e!==globalThis;let l=0;return I&&o&&(l=setTimeout(console.warn,1e3,`ðŸ’€ðŸ”’ - Possible deadlock if proxy.${r}(...args) is awaited`)),M(o,n).value.then((()=>{clearTimeout(l);const e=n[1];if(!e)return;const t=w*e;return n=new y(new i(t+t%d)),E([],a,n),M(o,n).value.then((()=>c(T.decode(new p(n.buffer).slice(0,e)))))}))},[s](a,n,s){const i=typeof s;if(i!==t)throw new Error(`Unable to assign ${n} as ${i}`);if(!a.size){const t=new h;e.addEventListener("message",(async e=>{const n=e.data?.[r];if(o(n)){e.stopImmediatePropagation();const[r,s,...o]=n;let i;if(o.length){const[e,n]=o;if(a.has(e)){I=!0;try{const o=await a.get(e)(...n);if(void 0!==o){const e=j(O?O(o):o);t.set(r,e),s[1]=e.length}}catch(e){i=e}finally{I=!1}}else i=new Error(`Unsupported action: ${e}`);s[0]=1}else{const e=t.get(r);t.delete(r);for(let t=new p(s.buffer),r=0;r<e.length;r++)t[r]=e.charCodeAt(r)}if(l(s,0),i)throw i}}))}return!!a.set(n,s)}}))}return m.get(e)};j.transfer=(...e)=>(g.add(e),e);const O=j;class A{constructor(t){Object.defineProperty(this,"databasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"worker",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"proxy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isWorkerDestroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"userCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"queriesInProgress",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"processMessageEvent",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.data,r=this.queriesInProgress;switch(t.type){case"success":case"data":case"error":if(t.queryKey&&r.has(t.queryKey)){const[e,a]=r.get(t.queryKey);"error"===t.type?a(t.error):e(t),r.delete(t.queryKey)}else if("error"===t.type)throw t.error;break;case"callback":const e=this.userCallbacks.get(t.name);e&&e(...t.args??[])}}}),Object.defineProperty(this,"createQuery",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!0===this.isWorkerDestroyed)throw new Error("This SQLocal client has been destroyed. You will need to initialize a new client in order to make further queries.");const t=((e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[e]];return t})();if("import"===e.type)this.worker.postMessage({...e,queryKey:t},[e.database]);else this.worker.postMessage({...e,queryKey:t});return new Promise(((e,r)=>{this.queriesInProgress.set(t,[e,r])}))}}),Object.defineProperty(this,"convertSqlTemplate",{enumerable:!0,configurable:!0,writable:!0,value:(e,...t)=>({sql:e.join("?"),params:t})}),Object.defineProperty(this,"convertRowsToObjects",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{let r;return r=(e=>!e.some((e=>!Array.isArray(e))))(e)?e:[e],r.map((e=>{const r={};return t.forEach(((t,a)=>{r[t]=e[a]})),r}))}}),Object.defineProperty(this,"exec",{enumerable:!0,configurable:!0,writable:!0,value:async(e,t,r="all")=>{const a=await this.createQuery({type:"query",sql:e,params:t,method:r}),n={rows:[],columns:[]};return"data"===a.type&&(n.rows=a.data[0].rows,n.columns=a.data[0].columns),n}}),Object.defineProperty(this,"execBatch",{enumerable:!0,configurable:!0,writable:!0,value:async e=>{const t=await this.createQuery({type:"batch",statements:e}),r=new Array(e.length).fill({rows:[],columns:[]});return"data"===t.type&&t.data.forEach(((e,t)=>{r[t]=e})),r}}),Object.defineProperty(this,"sql",{enumerable:!0,configurable:!0,writable:!0,value:async(e,...t)=>{const r=this.convertSqlTemplate(e,...t),{rows:a,columns:n}=await this.exec(r.sql,r.params,"all");return this.convertRowsToObjects(a,n)}}),Object.defineProperty(this,"transaction",{enumerable:!0,configurable:!0,writable:!0,value:async e=>{const t=e(this.convertSqlTemplate);return(await this.execBatch(t)).map((({rows:e,columns:t})=>this.convertRowsToObjects(e,t)))}}),Object.defineProperty(this,"createCallbackFunction",{enumerable:!0,configurable:!0,writable:!0,value:async(e,t)=>{await this.createQuery({type:"function",functionName:e,functionType:"callback"}),this.userCallbacks.set(e,t)}}),Object.defineProperty(this,"createScalarFunction",{enumerable:!0,configurable:!0,writable:!0,value:async(e,t)=>{await this.createQuery({type:"function",functionName:e,functionType:"scalar"}),this.proxy[`_sqlocal_func_${e}`]=t}}),Object.defineProperty(this,"getDatabaseFile",{enumerable:!0,configurable:!0,writable:!0,value:async()=>{const e=await navigator.storage.getDirectory(),t=await e.getFileHandle(this.databasePath);return await t.getFile()}}),Object.defineProperty(this,"overwriteDatabaseFile",{enumerable:!0,configurable:!0,writable:!0,value:async e=>{let t;t=e instanceof Blob?await e.arrayBuffer():e,await this.createQuery({type:"import",database:t})}}),Object.defineProperty(this,"destroy",{enumerable:!0,configurable:!0,writable:!0,value:async()=>{await this.createQuery({type:"destroy"}),this.worker.removeEventListener("message",this.processMessageEvent),this.queriesInProgress.clear(),this.userCallbacks.clear(),this.worker.terminate(),this.isWorkerDestroyed=!0}}),this.worker=new Worker(new URL(e.p+e.u(9),e.b),{type:void 0}),this.worker.addEventListener("message",this.processMessageEvent),this.proxy=O(this.worker),this.databasePath=t,this.worker.postMessage({type:"config",key:"databasePath",value:t})}}var k,E,q;function S(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a,n,s,o,i=[],c=!0,l=!1;try{if(s=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(a=s.call(r)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(e){l=!0,n=e}finally{try{if(!c&&null!=r.return&&(o=r.return(),Object(o)!==o))return}finally{if(l)throw n}}return i}}(e,t)||M(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e){return function(e){if(Array.isArray(e))return I(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||M(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){if(e){if("string"==typeof e)return I(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?I(e,t):void 0}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=Array(t);r<t;r++)a[r]=e[r];return a}function x(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(q="undefined"!=typeof window?window:e.g).openDatabase||(q.openDatabase=function(e,t,r,a,n){var s=new A(e+".sqlite3"),o=s.transaction;function i(){this.version=t,this.name=e}s.sql(k||(k=x(["PRAGMA synchronous = NORMAL"]))),s.sql(E||(E=x(["PRAGMA journal_mode = WAL"]))),i.prototype.transaction=function(e,t,r){var a=[],n=!1,s={executeSql:function(e,t,r,s){return new Promise((function(o,c){a.push({sql:e,args:t,onSuccess:r,onError:s,resolve:o,reject:c}),n||i()}))}};function i(){if(0===a.length)return n=!1,void(r&&r());n=!0;var e=a.shift(),c=e.sql,l=e.args,u=e.onSuccess,f=e.onError,b=e.resolve,y=e.reject;o((function(e){return[e.apply(void 0,["".concat(c).split("?")].concat(T(l||[])))]})).then((function(e){var r=S(e,1)[0],a={rows:{item:function(e){return r[e]},length:r.length},insertId:r.lastInsertRowid,rowsAffected:r.changes};u?Promise.resolve().then((function(){return u(s,a)})).then((function(){b(a),i()})).catch((function(e){f&&f(s,e),y(e),t&&t(e)})):(b(a),i())})).catch((function(e){f&&f(s,e),y(e),t&&t(e)}))}try{e(s)}catch(e){return void(t&&t(e))}!n&&a.length>0&&i()};var c=new i;return n&&n(c),c})})();